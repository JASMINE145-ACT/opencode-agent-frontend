<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Settings | DataOrchestrator - Data Platform & AI Agent</title>
    <script src="./components/api-client.js" type="module"></script>
  </head>
  <body
    x-data="{
      page: 'settings',
      'loaded': true,
      'darkMode': false,
      'stickyMenu': false,
      'sidebarToggle': false,
      'scrollTop': false,
      dataPlatformUrl: 'http://localhost:8000',
      opencodeAgentUrl: 'http://localhost:8001',
      useMockMode: true,
      email: localStorage.getItem('user') ? JSON.parse(localStorage.getItem('user')).email : '',
      isSaving: false,
      saveMessage: null
    }"
    x-init="
      darkMode = JSON.parse(localStorage.getItem('darkMode'));
      $watch('darkMode', value => localStorage.setItem('darkMode', JSON.stringify(value)));
      if (!localStorage.getItem('token')) {
        window.location.href = 'login.html';
      }
      window.logout = async function() {
        localStorage.removeItem('token');
        localStorage.removeItem('user');
        window.location.href = 'login.html';
      };
      window.saveSettings = async function() {
        isSaving = true;
        saveMessage = null;
        
        try {
          // Save API URLs to localStorage
          localStorage.setItem('dataPlatformUrl', dataPlatformUrl);
          localStorage.setItem('opencodeAgentUrl', opencodeAgentUrl);
          localStorage.setItem('useMockMode', useMockMode);
          
          // Update user email
          const user = { email: email };
          localStorage.setItem('user', JSON.stringify(user));
          
          saveMessage = { type: 'success', text: 'Settings saved successfully!' };
          
          setTimeout(() => {
            saveMessage = null;
          }, 3000);
        } catch (err) {
          saveMessage = { type: 'error', text: 'Failed to save settings: ' + err.message };
        } finally {
          isSaving = false;
        }
      };
    "
    :class="{'dark bg-gray-900': darkMode === true}"
  >
    <!-- ===== Preloader Start ===== -->
    <include src="./partials/preloader.html"></include>
    <!-- ===== Preloader End ===== -->

    <!-- ===== Page Wrapper Start ===== -->
    <div class="flex h-screen overflow-hidden">
      <!-- ===== Sidebar Start ===== -->
      <include src="./partials/sidebar-custom.html"></include>
      <!-- ===== Sidebar End ===== -->

      <!-- ===== Content Area Start ===== -->
      <div
        class="relative flex flex-col flex-1 overflow-x-hidden overflow-y-auto"
      >
        <!-- Small Device Overlay Start -->
        <include src="./partials/overlay.html" />
        <!-- Small Device Overlay End -->

        <!-- ===== Header Start ===== -->
        <include src="./partials/header-custom.html" />
        <!-- ===== Header End ===== -->

        <!-- ===== Main Content Start ===== -->
        <main>
          <div class="p-4 mx-auto max-w-(--breakpoint-2xl) md:p-6">
            <!-- Page Title -->
            <div class="mb-6">
              <h1 class="mb-1 font-semibold text-gray-800 text-title-md dark:text-white/90">
                Settings
              </h1>
              <p class="text-sm text-gray-500 dark:text-gray-400">
                Configure your preferences and backend connections
              </p>
            </div>

            <!-- Save Message -->
            <div
              x-show="saveMessage"
              class="mb-6 p-4 rounded-lg"
              :class="{
                'bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-400': saveMessage.type === 'success',
                'bg-red-50 text-red-700 dark:bg-red-900/20 dark:text-red-400': saveMessage.type === 'error'
              }"
            >
              <span x-text="saveMessage.text"></span>
            </div>

            <div class="grid grid-cols-1 gap-6 lg:grid-cols-2">
              <!-- Profile Settings -->
              <div class="p-6 bg-white border border-gray-200 rounded-xl dark:bg-gray-800 dark:border-gray-700">
                <h3 class="mb-6 font-semibold text-gray-800 dark:text-white">
                  Profile Settings
                </h3>
                <div class="space-y-6">
                  <div>
                    <label class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-400">
                      Email Address
                    </label>
                    <input
                      x-model="email"
                      type="email"
                      placeholder="your@email.com"
                      class="w-full px-4 py-3 rounded-lg border border-gray-300 bg-transparent text-sm text-gray-800 focus:border-brand-300 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800"
                    />
                  </div>
                </div>
              </div>

              <!-- Appearance Settings -->
              <div class="p-6 bg-white border border-gray-200 rounded-xl dark:bg-gray-800 dark:border-gray-700">
                <h3 class="mb-6 font-semibold text-gray-800 dark:text-white">
                  Appearance
                </h3>
                <div class="space-y-6">
                  <div class="flex items-center justify-between">
                    <div>
                      <div class="text-sm font-medium text-gray-800 dark:text-white">
                        Dark Mode
                      </div>
                      <div class="text-xs text-gray-500 dark:text-gray-400">
                        Enable dark theme across the application
                      </div>
                    </div>
                    <button
                      @click="darkMode = !darkMode"
                      class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors"
                      :class="darkMode ? 'bg-brand-500' : 'bg-gray-300'"
                    >
                      <span
                        class="inline-block size-4 rounded-full bg-white transition-transform"
                        :class="darkMode ? 'translate-x-6' : 'translate-x-1'"
                      ></span>
                    </button>
                  </div>
                </div>
              </div>

              <!-- Backend API Configuration -->
              <div class="p-6 bg-white border border-gray-200 rounded-xl dark:bg-gray-800 dark:border-gray-700 lg:col-span-2">
                <h3 class="mb-6 font-semibold text-gray-800 dark:text-white">
                  Backend API Configuration
                </h3>
                <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
                  <div>
                    <label class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-400">
                      Data Platform API URL
                    </label>
                    <input
                      x-model="dataPlatformUrl"
                      type="url"
                      placeholder="http://localhost:8000"
                      class="w-full px-4 py-3 rounded-lg border border-gray-300 bg-transparent text-sm text-gray-800 focus:border-brand-300 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800"
                    />
                    <p class="mt-2 text-xs text-gray-500 dark:text-gray-400">
                      Backend for data queries and analytics
                    </p>
                  </div>
                  <div>
                    <label class="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-400">
                      OpenCode Agent API URL
                    </label>
                    <input
                      x-model="opencodeAgentUrl"
                      type="url"
                      placeholder="http://localhost:8001"
                      class="w-full px-4 py-3 rounded-lg border border-gray-300 bg-transparent text-sm text-gray-800 focus:border-brand-300 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800"
                    />
                    <p class="mt-2 text-xs text-gray-500 dark:text-gray-400">
                      Backend for Excel analysis and chat
                    </p>
                  </div>
                </div>
              </div>

              <!-- API Mode Settings -->
              <div class="p-6 bg-white border border-gray-200 rounded-xl dark:bg-gray-800 dark:border-gray-700 lg:col-span-2">
                <h3 class="mb-6 font-semibold text-gray-800 dark:text-white">
                  API Mode
                </h3>
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg dark:bg-gray-700">
                  <div>
                    <div class="text-sm font-medium text-gray-800 dark:text-white">
                      Mock Mode (Data Platform)
                    </div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">
                      Use simulated data instead of real API calls for development
                    </div>
                  </div>
                  <button
                    @click="useMockMode = !useMockMode"
                    class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors"
                    :class="useMockMode ? 'bg-brand-500' : 'bg-gray-300'"
                  >
                    <span
                      class="inline-block size-4 rounded-full bg-white transition-transform"
                      :class="useMockMode ? 'translate-x-6' : 'translate-x-1'"
                    ></span>
                  </button>
                </div>
                <div class="mt-4 p-4 bg-blue-50 rounded-lg dark:bg-blue-900/20">
                  <div class="flex items-start gap-3">
                    <svg
                      class="flex-shrink-0 text-blue-500"
                      width="20"
                      height="20"
                      viewBox="0 0 20 20"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="M10 18C14.4183 18 18 14.4183 18 10C18 5.58172 14.4183 2 10 2C5.58172 2 2 5.58172 2 10C2 14.4183 5.58172 18 10 18ZM10 20C15.5228 20 20 15.5228 20 10C20 4.47715 15.5228 0 10 0C4.47715 0 0 4.47715 0 10C0 15.5228 4.47715 20 10 20ZM9 13H11V15H9V13ZM9 5H11V11H9V5Z"
                        fill="currentColor"
                      />
                    </svg>
                    <div class="text-xs text-gray-600 dark:text-gray-400">
                      <span class="font-medium">Note:</span> When Mock Mode is enabled, the Data Platform will return simulated data. Disable this setting to connect to the real backend API.
                    </div>
                  </div>
                </div>
              </div>

              <!-- Save Button -->
              <div class="lg:col-span-2">
                <button
                  @click="saveSettings()"
                  :disabled="isSaving"
                  class="w-full px-6 py-3 text-sm font-medium text-white transition rounded-lg bg-brand-500 shadow-theme-xs hover:bg-brand-600 disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  <span x-show="!isSaving">Save Settings</span>
                  <span x-show="isSaving">
                    <svg class="inline animate-spin h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Saving...
                  </span>
                </button>
              </div>
            </div>

            <!-- Version Info -->
            <div class="mt-8 text-center">
              <p class="text-xs text-gray-500 dark:text-gray-400">
                DataOrchestrator Frontend v1.0.0
              </p>
            </div>
          </div>
        </main>
        <!-- ===== Main Content End ===== -->
      </div>
      <!-- ===== Content Area End ===== -->
    </div>
    <!-- ===== Page Wrapper End ===== -->
  </body>
</html>
